<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Tính Lạm Phát VNĐ dựa vào XAUUSD</title>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 20px;
      background: #f5f5f5;
      color: #333;
      max-width: 600px;
      margin: 0 auto;
    }

    h2 {
      font-size: 1.5em;
      margin-bottom: 20px;
      text-align: center;
    }

    select,
    input,
    button {
      padding: 8px;
      margin: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 1em;
    }

    input[type="text"] {
      width: 120px;
    }

    button {
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: #0056b3;
    }

    #output {
      margin-top: 20px;
      padding: 15px;
      background: white;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      font-size: 1em;
      line-height: 1.5;
    }

    .result {
      font-weight: 600;
      color: #007bff;
    }

    /* Responsive adjustments for iPhone (screen width <= 414px) */
    @media (max-width: 414px) {
      body {
        padding: 4vw;
        max-width: 100%;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
        min-height: 100vh;
      }

      h2 {
        font-size: 1.2rem;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 1rem;
      }

      label {
        margin-bottom: 0.3rem;
        font-size: 0.9rem;
        font-weight: 500;
      }

      select,
      input,
      button {
        padding: 0.7rem;
        margin: 0.3rem 0;
        border-radius: 8px;
        font-size: 0.9rem;
        width: 100%;
        box-sizing: border-box;
      }

      input[type="text"] {
        max-width: 100%;
      }

      #output {
        margin-top: 1rem;
        padding: 1rem;
        font-size: 0.85rem;
      }
    }

    /* Dark mode support for iPhone */
    @media (max-width: 414px) and (prefers-color-scheme: dark) {
      body {
        background: #1c2526;
        color: #e0e0e0;
      }

      #output {
        background: #2c3e50;
        color: #e0e0e0;
      }

      select,
      input {
        background: #34495e;
        color: #e0e0e0;
        border-color: #4a6076;
      }

      button {
        background: #1e90ff;
      }

      button:hover {
        background: #1565c0;
      }
    }
  </style>
</head>

<body>
  <h2>Tính Lạm Phát VNĐ dựa vào XAUUSD</h2>

  <div class="input-group">
    <label>Tháng:</label>
    <select id="month1">
      <script>
        for (let i = 1; i <= 12; i++) {
          document.write(`<option value="${i.toString().padStart(2, '0')}">${i}</option>`);
        }
      </script>
    </select>

    <label>Năm:</label>
    <select id="year1">
      <script>
        for (let i = 1970; i <= 2025; i++) {
          document.write(`<option value="${i}">${i}</option>`);
        }
      </script>
    </select>
  </div>

  <div class="input-group">
    <label>Số tiền (VND):</label>
    <input type="text" id="amount" value="1.000.000" oninput="formatNumber(this)" />
  </div>

  <div class="input-group">
    <label>So sánh với:</label>
    <select id="month2">
      <script>
        for (let i = 1; i <= 12; i++) {
          document.write(`<option value="${i.toString().padStart(2, '0')}">${i}</option>`);
        }
      </script>
    </select>
    <select id="year2">
      <script>
        for (let i = 1970; i <= 2025; i++) {
          document.write(`<option value="${i}">${i}</option>`);
        }
      </script>
    </select>
    <button onclick="setCurrentDate()">Hiện Tại 07/2025</button>
  </div>

  <button onclick="searchData()">Tính Toán</button>

  <div id="output">Đang tải dữ liệu...</div>

  <script>
    function formatNumber(input) {
      let value = input.value.replace(/\./g, '');
      value = value.replace(/[^0-9]/g, '');
      if (value) {
        input.value = Number(value).toLocaleString('vi-VN', { minimumFractionDigits: 0 });
      } else {
        input.value = '';
      }
    }

    let xauData = [];
    let usdData = [];
    let loaded = 0;

    function checkReady() {
      if (loaded === 2) {
        document.getElementById('output').innerText = "Dữ liệu đã tải thành công";
      }
    }

    fetch('xausd.xlsx')
      .then(res => res.arrayBuffer())
      .then(buffer => {
        const workbook = XLSX.read(buffer, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        xauData = XLSX.utils.sheet_to_json(sheet);
        loaded++;
        checkReady();
      })
      .catch(err => {
        document.getElementById('output').innerText = "Không thể tải tệp xausd.xlsx";
        console.error(err);
      });

    fetch('usdvnd.xlsx')
      .then(res => res.arrayBuffer())
      .then(buffer => {
        const workbook = XLSX.read(buffer, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        usdData = XLSX.utils.sheet_to_json(sheet);
        loaded++;
        checkReady();
      })
      .catch(err => {
        document.getElementById('output').innerText = "Không thể tải tệp usdvnd.xlsx";
        console.error(err);
      });

    function setCurrentDate() {
      document.getElementById('month2').value = '07';
      document.getElementById('year2').value = '2025';
    }

    window.onload = function() {
      setCurrentDate();
    };

    function searchData() {
      const month1 = document.getElementById('month1').value;
      const year1 = document.getElementById('year1').value;
      const amount = parseFloat(document.getElementById('amount').value.replace(/\./g, '')) || 0;
      const target1 = `01/${month1}/${year1}`;

      const month2 = document.getElementById('month2').value;
      const year2 = document.getElementById('year2').value;
      const target2 = `01/${month2}/${year2}`;

      const xauRow1 = xauData.find(r => {
        const dayStr = r.day?.toString().split(" ")[0];
        return dayStr === target1;
      });
      const xauOpen1 = (xauRow1 && xauRow1.open !== undefined) ? xauRow1.open : null;

      const usdRow1 = usdData.find(r => {
        const dayStr = r.day?.toString().split(" ")[0];
        return dayStr === target1;
      });
      const usdOpen1 = (usdRow1 && usdRow1.open !== undefined) ? usdRow1.open : 11000;

      const xauRow2 = xauData.find(r => {
        const dayStr = r.day?.toString().split(" ")[0];
        return dayStr === target2;
      });
      const xauOpen2 = (xauRow2 && xauRow2.open !== undefined) ? xauRow2.open : null;

      const usdRow2 = usdData.find(r => {
        const dayStr = r.day?.toString().split(" ")[0];
        return dayStr === target2;
      });
      const usdOpen2 = (usdRow2 && usdRow2.open !== undefined) ? usdRow2.open : 11000;

      let output = '';
      if (xauOpen1 && usdOpen1 && xauOpen2 && usdOpen2) {
        const gold_at_year1 = xauOpen1 * usdOpen1;
        const gold_at_year2 = xauOpen2 * usdOpen2;
        const amount2 = Math.round((amount / gold_at_year1) * gold_at_year2);

        output += `
          <div class="result">${amount.toLocaleString('vi-VN', { minimumFractionDigits: 0 })} VND trong năm ${year1} tương đương với ${amount2.toLocaleString('vi-VN', { minimumFractionDigits: 0 })} VND trong năm ${year2}</div>
        `;
      } else {
        output += `<div class="result">Không đủ dữ liệu để tính giá trị tương đương</div>`;
      }

      document.getElementById('output').innerHTML = output;
    }
  </script>
</body>
</html>